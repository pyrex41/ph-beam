PRD 3: The AI Co-Pilot Experience
Theme: Transforming the AI agent into an intuitive, conversational, and intelligent design partner.
Vision & Goal: To create a "delightful" AI experience that feels less like a command line and more like a conversation, enabling users to perform complex actions with simple, natural language and voice.
Target Persona: Both the Power Designer (using AI for complex selections) and the Collaborative Team Leader (using AI to quickly prototype ideas).
Feature ID	Feature Name	Description & User Value	Acceptance Criteria & Metrics	Technical Implementation Notes
AIX-00	Composable AI Tool Framework	Create a plugin-based architecture for AI tools that allows new canvas features to be exposed to the AI with minimal code changes. User Value: This is an ARCHITECTURAL FOUNDATION that enables rapid AI integration as new features are developed, reduces technical debt, and makes the codebase maintainable. Developer Value: Adding a new AI capability becomes as simple as creating a single self-contained module - no changes to core Agent code required.	1. New tools can be added in a single file (lib/collab_canvas/ai/tools/*.ex). 2. Tools are automatically discovered and registered at compile time. 3. All existing tools (create_shape, delete_object, arrange_objects) successfully migrated to new system. 4. Hybrid execution works: new plugin tools and legacy tools coexist during migration. 5. Individual tools can be tested in isolation.	- Backend: Implement Tool behaviour pattern (lib/collab_canvas/ai/tool.ex) defining definition/0 and execute/2 callbacks. Create ToolRegistry (lib/collab_canvas/ai/tool_registry.ex) with auto-discovery of modules implementing Tool behaviour. Update Agent.ex to try ToolRegistry first, then fall back to legacy pattern matching. Migration approach: Create tools/ directory, migrate 3 example tools (create_shape, delete_object, arrange_objects), rename legacy execute_tool_call clauses to execute_tool_call_legacy for backward compatibility.
AIX-01	AI Semantic Selection	Create a new AI tool, select_objects_by_description, enabling commands like "select all small red circles" or "select the objects in the top-left corner." User Value: This is a killer feature that provides a massive productivity boost, allowing users to make complex, context-aware selections that are impossible to do manually. NOTE: This feature is blocked until underlying selection infrastructure (lasso selection, advanced filtering) is implemented. The composable framework (AIX-00) makes integration trivial once the infrastructure exists.	1. The AI correctly interprets and selects objects based on at least two combined attributes (e.g., color and shape). 2. The AI can handle vague terms like "small" or "top left" by reasoning over the canvas context. 3. Selection success rate is >90% on the test suite (AIX-05).	- Backend: With the new framework (AIX-00), this becomes a single-file implementation: lib/collab_canvas/ai/tools/semantic_selection.ex implementing the Tool behaviour. The Agent.ex module's build_command_with_context function must be enhanced to provide the AI with a comprehensive list of all objects and their properties for every request. DEPENDENCY: Requires canvas selection infrastructure to be built first.
AIX-02	Voice Command Input	Add a "push-to-talk" microphone icon that uses the browser's SpeechRecognition API to stream a live transcription into the AI input field. User Value: Makes AI interaction faster, more accessible, and more natural, transforming the design process into a fluid conversation.	1. Transcription appears in the input field in real-time with <500ms latency. 2. The system handles microphone permissions gracefully. 3. The transcribed text can be edited before being submitted.	- Frontend: Implement in JavaScript. This will require a new hook or modifications to app.js to manage the microphone state and API interaction. Add UI feedback for "listening" and "transcribing" states.
AIX-03	AI Interaction History Panel	Replace the AI input area with a persistent, scrollable, chat-like panel. It will display a history of user commands and the AI's responses (e.g., "âœ… Created 3 objects"). User Value: Provides a clear, auditable trail of AI interactions, making the AI's behavior transparent and allowing users to review their workflow.	1. The panel displays the last 20+ AI interactions. 2. The input field is docked at the bottom of this panel. 3. AI responses are clearly distinguished from user commands.	- Backend: This is primarily a CanvasLive template and state management change. The "history" can be stored in the socket assigns for the duration of the session.
AIX-04	'Enter' to Submit Command	Configure the AI command textarea so Enter submits the command and Shift+Enter adds a newline. User Value: A critical quality-of-life improvement that aligns with user expectations for chat and command interfaces, making the interaction feel faster and more intuitive.	1. Pressing Enter triggers the execute_ai_command event. 2. The textarea is cleared upon successful submission.	- Frontend: This is a small JavaScript enhancement, likely a few lines of code in a JS hook attached to the form.
AIX-05	AI Command Test Suite	Create a dedicated test suite for the AI Agent. This suite will include 20-30 core commands, each with 3-5 variations to test for robustness against different phrasing and combinations. User Value: Guarantees the reliability and consistency of the AI features, preventing regressions and building user trust in the AI co-pilot.	1. The test suite is part of the mix test command. 2. It covers creation, manipulation, layout, and selection commands. 3. A test fails if the AI agent does not produce the expected canvas state change.	- Testing: Create a new test file, e.g., test/collab_canvas/ai/agent_test.exs. The tests will call Agent.execute_command/3 with a mock canvas_id and assert on the returned results tuple.
Cross-PRD Dependencies & Integration:
AI Semantic Selection (AIX-01) is the capstone feature that integrates with Grouping (WF-01). A user could issue a command like, "select all the primary buttons and group them."
The AI Test Suite (AIX-05) must be updated as new AI-enabled features from PRD #1 and PRD #2 (e.g., layering, new shapes) are added.
Risks & Mitigation:
Risk: The browser SpeechRecognition API (AIX-02) has inconsistent support and quality across different browsers. Mitigation: Design the UI gracefully, providing clear feedback if the API is unavailable and ensuring the text input remains the primary, fully-supported method.
Risk: Semantic selection (AIX-01) can be computationally expensive or have unpredictable LLM results. Mitigation: Heavily rely on providing excellent context in the prompt and have a robust testing framework (AIX-05) to catch regressions. Cache results for identical commands if possible.
